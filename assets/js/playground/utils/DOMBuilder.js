/*! ArcGIS API for JavaScript 4.12 | Copyright (c) 2019 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["esri-playground-js/utils/CurrentState","esri-playground-js/utils/mainUtils","esri-playground-js/utils/ObjectProvider","dijit/registry"],function(CurrentState,mainUtils,ObjectProvider,registry){"use-strict";var domBuilder={};var _createNode=function(param){var node;node=document.createElement(param.tag);if(param.data){node.innerHTML=param.data}if(param.class){node.className=param.class}if(param.id){node.setAttribute("id",param.id)}return node};var _createListNode=function(list){var listNode=document.createElement("ul");list.forEach(function(item){var li=document.createElement("li");var textNode=_createNode({data:item["name"],tag:"p"});li.setAttribute("data-config-loc",item["location"]);li.setAttribute("data-config-name",item["name"]);li.appendChild(textNode);var i;if(item["message"]){i=_createNode({tag:"i",class:"fa fa-exclamation-circle"});if(item["error"]){i.style.color="#e74c3c"}li.setAttribute("data-tooltip",item["message"]);li.className="hasToolTip";textNode.appendChild(i)}listNode.appendChild(li)});return listNode};var _createPropertiesList=function(param){var mainNode=param.node,node=document.createElement("ul");var properties=param.config["properties"];properties.forEach(function(prop){_appendItem({config:param.config,property:prop,node:node,domId:param.domId,isList:true,enableDelete:param.enableDelete})});if(mainNode==null){mainNode=_createNode({tag:"div"})}mainNode.appendChild(node);return mainNode};var _appendItem=function(param){var currentState=CurrentState.getInstance(),json=param.config,dataItem=param.property,node=param.node,domId=param.domId,enableDelete=param.enableDelete,isList=param.isList,item;if(isList){item=document.createElement("li")}else{item=_createNode({tag:"div",class:param.class})}if(domId){item.setAttribute("data-domId",domId)}var textNode,containerNode;if(dataItem["type"]==="Object"||dataItem["type"]==="Array"||dataItem["type"]==="Class"||dataItem["type"]==="Color"){var textHolder=_createNode({tag:"div",class:"nested-property-container"});textNode=_createNode({data:dataItem["name"],tag:"p",class:"nested-property-name"});if(dataItem["required"]){var spanNode=_createNode({data:"*",tag:"span"});textNode.appendChild(spanNode)}var valueHolder=_createNode({tag:"div"});var valueNode=_createNode({data:"expand",tag:"p",class:null,id:dataItem["domId"]+"-"+"TextID"});valueHolder.appendChild(valueNode);textHolder.appendChild(textNode);textHolder.appendChild(valueHolder);item.appendChild(textHolder);containerNode=_createNode({tag:"div",class:"modal-container"});item.addEventListener("click",function(event){containerNode.style.display="block";var dataBlockNode=document.getElementById("playArea").children[0].children[0];dataBlockNode.appendChild(containerNode);dataBlockNode.scrollTop=0;dataBlockNode.style.overflow="hidden";event.stopPropagation()})}else{textNode=_createNode({data:dataItem["name"],tag:"p",class:"property-name"});if(dataItem["required"]){var spanNode=_createNode({data:"*",tag:"span"});textNode.appendChild(spanNode)}item.appendChild(textNode);containerNode=_createNode({tag:"div",class:"property-value-container"});item.className="flexer"}if(dataItem["type"]==="Number"){if(dataItem["attributes"]&&dataItem["attributes"].min&&dataItem["attributes"].max){var inputNode=_createNode({tag:"input",class:"property-value",id:dataItem["domId"]+"-"+"RangeID"});inputNode.setAttribute("type","range");if(dataItem["default"]!==undefined){inputNode.setAttribute("placeholder",Math.round(dataItem["default"]*100)/100);inputNode.value=Math.round(dataItem["default"]*100)/100}else{inputNode.setAttribute("placeholder","enter "+dataItem["name"])}if(dataItem["attributes"]){for(var attr in dataItem["attributes"]){inputNode.setAttribute(attr,dataItem["attributes"][attr])}}containerNode.appendChild(inputNode);var inputNode=_createNode({tag:"input",class:"property-value",id:dataItem["domId"]+"-"+"ID"});inputNode.setAttribute("type","number");if(dataItem["default"]!==undefined){inputNode.setAttribute("placeholder",Math.round(dataItem["default"]*100)/100);inputNode.value=Math.round(dataItem["default"]*100)/100}else{inputNode.setAttribute("placeholder","enter "+dataItem["name"])}if(dataItem["attributes"]){for(var attr in dataItem["attributes"]){inputNode.setAttribute(attr,dataItem["attributes"][attr])}}containerNode.appendChild(inputNode)}else{var inputNode=_createNode({tag:"input",class:"property-value",id:dataItem["domId"]+"-"+"ID"});inputNode.setAttribute("type","number");if(dataItem["default"]!==undefined){inputNode.setAttribute("placeholder",Math.round(dataItem["default"]*100)/100);inputNode.value=Math.round(dataItem["default"]*100)/100}else{inputNode.setAttribute("placeholder","enter "+dataItem["name"])}if(dataItem["attributes"]){for(var attr in dataItem["attributes"]){inputNode.setAttribute(attr,dataItem["attributes"][attr])}}containerNode.appendChild(inputNode)}}else if(dataItem["type"]==="Boolean"){var checkboxContainer=_createNode({tag:"div",class:"checkbox-container"});var inputNode=_createNode({tag:"input",class:"property-value",id:dataItem["domId"]+"-"+"ID"});inputNode.setAttribute("type","checkbox");if(dataItem["default"]){inputNode.checked=true}var label=_createNode({tag:"label"});label.setAttribute("for",dataItem["domId"]+"-"+"ID");checkboxContainer.appendChild(inputNode);checkboxContainer.appendChild(label);containerNode.appendChild(checkboxContainer)}else if(dataItem["type"]==="String"){if(dataItem["options"]){var selectNode=_createNode({tag:"SELECT",class:"property-value",id:dataItem["domId"]+"-"+"ID"});selectNode.setAttribute("name",dataItem["name"]);var placeHolderNode=_createNode({data:"select "+dataItem["name"],tag:"option"});placeHolderNode.disabled=true;placeHolderNode.selected=true;placeHolderNode.style.background="#ecf0f1";selectNode.appendChild(placeHolderNode);var values=dataItem["options"]["values"];values.forEach(function(option){var optionNode=_createNode({tag:"option"});var name,value;if(typeof option==="string"){name=option;value=option}else{name=option.name;value=option.value}optionNode.innerHTML=name;optionNode.setAttribute("value",value);if(dataItem["default"]&&dataItem["default"]===value){optionNode.selected=true}selectNode.appendChild(optionNode)});containerNode.appendChild(selectNode)}else if(dataItem["value"]){var defaultNode=_createNode({data:dataItem["value"]+" (default)",tag:"p",class:"property-value",id:dataItem["domId"]+"-"+"ID"});containerNode.appendChild(defaultNode)}else{var inputNode=_createNode({tag:"input",class:"property-value",id:dataItem["domId"]+"-"+"ID"});inputNode.setAttribute("type","text");if(dataItem["default"]!==undefined){inputNode.setAttribute("placeholder",dataItem["default"])}else{inputNode.setAttribute("placeholder","enter "+dataItem["name"])}containerNode.appendChild(inputNode)}}else if(dataItem["type"]==="Color"){var idPrefix=dataItem["domId"]+"-";var colorHolderNode=_createNode({tag:"div",class:"colorDiv",id:idPrefix+"HolderID"});var colorNode=_createNode({tag:"div",class:"property-value",id:idPrefix+"ID"});colorHolderNode.appendChild(colorNode);_createModal(item,containerNode,dataItem["name"],colorNode)}else if(dataItem["type"]==="Object"){var subData=dataItem["config"]||dataItem;var subPropsNode=_createPropertiesList({config:subData});_createModal(item,containerNode,dataItem["name"],subPropsNode)}else if(dataItem["type"]==="Array"){var options=dataItem["options"];if(options.type==="Object"){_createSelectNode(item,dataItem,options,containerNode)}else if(options.type==="Color"){_createColorsNode(item,dataItem,containerNode)}else if(options.type==="Number"){_createNumberArrayNode(item,dataItem,containerNode)}}else if(dataItem["type"]==="Class"){var subData=dataItem["config"],options=dataItem["options"];if(subData){var propertiesNode=_createPropertiesList({config:subData});_createModal(item,containerNode,dataItem["name"],propertiesNode)}else if(options){_createSelectNode(item,dataItem,options,containerNode)}}item.appendChild(containerNode);if(enableDelete){var deleteNode=_createNode({tag:"i",class:"fa fa-trash-o"});item.appendChild(deleteNode);deleteNode.addEventListener("click",function(event){if(isList){var arr=currentState.statefulObject[json["name"]].slice(0),domId=item.getAttribute("data-domId"),index;json.properties.some(function(elem,idx){if(domId===elem.domId){index=idx;return true}});json.properties.splice(index,1);arr.splice(index,1);currentState.statefulObject.set(json["name"],arr)}else{param.selectNode.style.display="block";currentState.statefulObject.set(json["name"],null)}registry.findWidgets(item).forEach(function(widget){widget.destroy(true)});node.removeChild(item);if(node.childNodes.length===0){var parent=node.parentNode,grandParent=parent.parentNode;parent.removeChild(node);grandParent.removeChild(parent)}event.stopPropagation()})}node.appendChild(item);return node};var _createNumberArrayNode=function(item,dataItem,containerNode){var currentState=CurrentState.getInstance();var holderNode=_createNode({tag:"div",class:"inputSelect-block"});var button=_createNode({data:"Add",tag:"button"});holderNode.appendChild(button);_createModal(item,containerNode,dataItem["name"],holderNode);button.addEventListener("click",function(){var inputNode=_createNode({tag:"input",class:"property-value",id:dataItem["domId"]+"-"+"ID"});inputNode.setAttribute("type","text");inputNode.setAttribute("placeholder","enter "+dataItem["name"]);containerNode.firstChild.childNodes[1].appendChild(inputNode);inputNode.addEventListener("change",function(){dataItem["properties"].push(inputNode.value);var arr=[inputNode.value];currentState.statefulObject.set(dataItem["name"],arr)})})};var _createColorsNode=function(item,dataItem,containerNode){var selectNode=_createNode({tag:"div",class:"colorSelect-node",data:"select color"});var selectHolderNode=_createNode({tag:"div"});var button=_createNode({data:"Add",tag:"button"});var holderNode=_createNode({tag:"div",class:"colorSelect-block"});selectHolderNode.appendChild(selectNode);selectHolderNode.appendChild(button);holderNode.appendChild(selectHolderNode);_createModal(item,containerNode,dataItem["name"],holderNode);selectNode.addEventListener("click",function(){})};var _createSelectNode=function(item,dataItem,options,containerNode){var currentState=CurrentState.getInstance();var selectNode=_createNode({tag:"SELECT"});selectNode.setAttribute("name",dataItem["domId"]);options.values.forEach(function(val){if(val["type"]==="Class"){var optionNode=_createNode({data:val["className"],tag:"option"});optionNode.setAttribute("value",val["location"]);selectNode.appendChild(optionNode)}else if(val["type"]==="Object"){var optionNode=_createNode({data:val["name"],tag:"option"});optionNode.setAttribute("value",val["name"]);selectNode.setAttribute("data-type","Object");selectNode.appendChild(optionNode)}});var button=_createNode({data:"Add",tag:"button"});var selectHolderNode=_createNode({tag:"div"});var holderNode=_createNode({tag:"div",class:"typeSelect-block"});selectHolderNode.appendChild(selectNode);selectHolderNode.appendChild(button);holderNode.appendChild(selectHolderNode);_createModal(item,containerNode,dataItem["name"],holderNode);button.addEventListener("click",function(event){var loc=selectNode.value;if(loc){if(dataItem["properties"]){var type=selectNode.getAttribute("data-type"),config;if(type==="Object"){dataItem.options.values.some(function(option){if(option.name===loc){config=option;return true}})}else{config=mainUtils.parseConfig(require.toUrl("esri-playground-data")+"/"+loc,true)}var domId=dataItem["domId"]+"-"+dataItem["properties"].length;generateDomIds(config,domId);var prop;if(type==="Object"){prop=config;prop.domId=domId}else{prop={name:config["className"],className:config["className"],config:config,domId:domId,type:"Class"}}dataItem["properties"].push(prop);if(dataItem["properties"].length===1){var subPropsNode=_createPropertiesList({config:dataItem,domId:domId,enableDelete:true});containerNode.firstChild.childNodes[1].appendChild(subPropsNode);var arr=[ObjectProvider.getStatefullObject(config,currentState.statefulObject)];currentState.statefulObject.set(dataItem["name"],arr)}else{_appendItem({config:dataItem,property:prop,domId:domId,node:containerNode.firstChild.childNodes[1].childNodes[1].firstChild,isList:true,enableDelete:true});var arr=currentState.statefulObject[dataItem["name"]].slice(0);arr.push(ObjectProvider.getStatefullObject(config,currentState.statefulObject));currentState.statefulObject.set(dataItem["name"],arr)}}else{var domId=dataItem["domId"],config=mainUtils.parseConfig("esri-playground-data"+"/"+loc,true);generateDomIds(config,domId);dataItem["location"]=loc;dataItem["config"]=config;dataItem["className"]=config["className"];var prop={name:config["className"],type:"Class",config:config,className:config["className"],domId:domId};_appendItem({config:dataItem,property:prop,domId:domId,node:containerNode.firstChild.childNodes[1].firstChild,selectNode:selectHolderNode,class:"item",isList:false,enableDelete:true});currentState.statefulObject.set(dataItem["name"],ObjectProvider.getStatefullObject(config,currentState.statefulObject));selectHolderNode.style.display="none"}}event.stopPropagation()})};var _createModal=function(item,containerNode,propName,propsNode){var modalNode=_createNode({tag:"div",class:"modal"});var modalHeaderNode=_createNode({tag:"div",class:"header"});var titleNode=_createNode({data:propName,tag:"p",class:"title"});var closeNode=_createNode({tag:"i",class:"fa fa-times"});var modalBodyNode=_createNode({tag:"div",class:"body"});modalHeaderNode.appendChild(titleNode);modalHeaderNode.appendChild(closeNode);modalNode.appendChild(modalHeaderNode);modalBodyNode.appendChild(propsNode);modalNode.appendChild(modalBodyNode);closeNode.addEventListener("click",function(event){containerNode.style.display="none";var dataBlockNode=document.getElementById("playArea").children[0].children[0];dataBlockNode.removeChild(containerNode);item.appendChild(containerNode);if(dataBlockNode.children.length===1){dataBlockNode.style.overflow="auto"}event.stopPropagation()});containerNode.appendChild(modalNode)};var generateDomIds=function(json,prefix){json.properties.forEach(function(prop){var domId=prefix+"-"+prop["name"];if(prop.config){generateDomIds(prop.config,domId)}else{prop["domId"]=domId;if(prop.type==="Object"){generateDomIds(prop,domId)}}})};var getMainfragment=function(json){var dataContainer=_createNode({tag:"div",class:"data-container"});var propsNode=_createNode({tag:"div",class:"data-block"});generateDomIds(json,json["className"]);var propertiesBlock=_createPropertiesList({config:json,node:propsNode});dataContainer.appendChild(propertiesBlock);var fragment=document.createDocumentFragment();fragment.appendChild(dataContainer);return fragment};var getIndexfragment=function(json){var fragment=document.createDocumentFragment();if(json.constructor===Array){json.forEach(function(item){var containerNode=_createNode({tag:"div",class:"modules-container"});var titleNode=_createNode({data:item["name"],tag:"p",class:"title"});var listNode=_createListNode(item["list"]);containerNode.appendChild(titleNode);containerNode.appendChild(listNode);fragment.appendChild(containerNode)})}return fragment};domBuilder.getMainfragment=getMainfragment;domBuilder.getIndexfragment=getIndexfragment;return domBuilder});