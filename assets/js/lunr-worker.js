/*! ArcGIS API for JavaScript 4.12 | Copyright (c) 2019 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var throttle=function throttle(func,limit){var inThrottle=void 0;var lastFunc=void 0;var lastRan=void 0;return function(){var context=this;var args=arguments;if(!inThrottle){func.apply(context,args);lastRan=Date.now();inThrottle=true}else{clearTimeout(lastFunc);lastFunc=setTimeout(function(){if(Date.now()-lastRan>=limit){func.apply(context,args);lastRan=Date.now()}},limit-(Date.now()-lastRan))}}};function hasSearchResults(value){return value?value.length>0:false}function processAPIReferenceSearchResults(value,data){return new Promise(function(resolve,reject){if(value){var searchResultsArray=value.map(function(item){var searchData=data[item.ref];if(/\.html#/.test(searchData.page_url)){var searchRegEx=/[-\w]*(?=$)/im;searchData.secondary_search_term=searchRegEx.test(searchData.page_url)?searchData.page_url.match(searchRegEx)[0]:searchData.class}else{searchData.secondary_search_term=searchData.class}searchData.tertiary_search_term=searchData.package+"/"+searchData.class;return searchData});var hrefTextRegEx=/[-:.#\w]+(?=["']>)/i;var uniqueIDArray=searchResultsArray.map(function(item){var hrefTextMatch=item.html.match(hrefTextRegEx);item.muid=hrefTextMatch.length>0?hrefTextMatch[0]:item.html;return item});var sortedResults=uniqueIDArray.sort(function(a,b){return b.rank-a.rank||a.secondary_search_term.localeCompare(b.secondary_search_term)||a.tertiary_search_term.localeCompare(b.tertiary_search_term)});var uniqueSortedResults=_.uniqBy(sortedResults,"muid");resolve({records:uniqueSortedResults})}else{resolve({records:[]})}})}if(typeof importScripts==="function"){var workerHref=self.location.href;var baseURL=workerHref.replace(/\/lunr-worker\.js[-=?#&_~[\]@!"$'()*+.,;:\w\d]*/,"");self.importScripts(baseURL+"/libs/lunr.js",baseURL+"/api-reference-lunr.js",baseURL+"/sample-code-lunr.js",baseURL+"/libs/lodash.js");if(typeof Promise==="undefined"){self.importScripts(baseURL+"/libs/es6-promise.js");self.importScripts(baseURL+"/libs/es6-promise.auto.js")}var apiRefSerializedIndex=esriAPIReferenceLunrData.searchindex;var apiRefSearchData=esriAPIReferenceLunrData.searchdata;var apiRefSearchIndex=lunr.Index.load(apiRefSerializedIndex);var isAPIReferenceSearchReady=typeof apiRefSerializedIndex.version==="string"&&(typeof apiRefSearchData==="undefined"?"undefined":_typeof(apiRefSearchData))==="object";var sampleCodeSerializedIndex=esriSampleCodeLunrData.searchindex;var sampleCodeSearchData=esriSampleCodeLunrData.searchdata;lunr.tokenizer.separator=/[,s]+/;var sampleCodeSearchIndex=lunr.Index.load(sampleCodeSerializedIndex);var isSampleCodeSearchReady=typeof sampleCodeSerializedIndex.version==="string"&&(typeof sampleCodeSearchData==="undefined"?"undefined":_typeof(sampleCodeSearchData))==="object";var readyMessage={type:"ready",sample_code_lunr_index_loaded:isSampleCodeSearchReady,api_reference_lunr_index_loaded:isAPIReferenceSearchReady};var searchMilliSecondsDelay=500;onmessage=throttle(function(messageEvent){var resultCountThreshold=50;var hasResults=false;var workerData=messageEvent.data;var workerResult={messageId:workerData.messageId,results:[],type:workerData.type};if(workerData.type==="api-reference-search"){var apiRefLunrSearchResults=undefined;var apiRefSearchTerm=workerData.value;workerResult.value=apiRefSearchTerm;if(/\*$/g.test(apiRefSearchTerm)){apiRefLunrSearchResults=apiRefSearchIndex.search(apiRefSearchTerm);hasResults=hasSearchResults(apiRefLunrSearchResults);if(hasResults){processAPIReferenceSearchResults(apiRefLunrSearchResults,apiRefSearchData).then(function(resolve){workerResult.results=resolve.records;postMessage(workerResult)})}else{workerResult.results=[];postMessage(workerResult)}}else{if(/(\w+\s)+\w+/g.test(apiRefSearchTerm)&&!hasResults){apiRefSearchTerm=apiRefSearchTerm.replace(/\s+/g,"*");try{var resultsB=[];var resultsC=[];var resultsA=apiRefSearchIndex.search(apiRefSearchTerm);if(resultsA&&resultsA.length<resultCountThreshold){resultsB=apiRefSearchIndex.search(apiRefSearchTerm+"*")}if(resultsA&&resultsA.length<resultCountThreshold&&resultsB&&resultsB.length<resultCountThreshold){resultsC=apiRefSearchIndex.search("*"+apiRefSearchTerm+"*")}apiRefLunrSearchResults=resultsA.concat(resultsB,resultsC);hasResults=hasSearchResults(apiRefLunrSearchResults);if(hasResults){processAPIReferenceSearchResults(apiRefLunrSearchResults,apiRefSearchData).then(function(resolve){workerResult.results=resolve.records;postMessage(workerResult)})}else{workerResult.results=[];postMessage(workerResult)}}catch(error){workerResult.error=error;postMessage(workerResult);console.log("worker - error: %s",error)}}if(!/\*/g.test(apiRefSearchTerm)&&!/\s/g.test(apiRefSearchTerm)&&!hasResults){try{var resultsE=[];var resultsF=[];var resultsD=apiRefSearchIndex.search(apiRefSearchTerm);if(resultsD&&resultsD.length<resultCountThreshold){resultsE=apiRefSearchIndex.search(apiRefSearchTerm+"*")}if(resultsD&&resultsD.length<resultCountThreshold&&resultsE&&resultsE.length<resultCountThreshold){resultsF=apiRefSearchIndex.search("*"+apiRefSearchTerm+"*")}apiRefLunrSearchResults=resultsD.concat(resultsE,resultsF);hasResults=hasSearchResults(apiRefLunrSearchResults);if(hasResults){processAPIReferenceSearchResults(apiRefLunrSearchResults,apiRefSearchData).then(function(resolve){workerResult.results=resolve.records;postMessage(workerResult)})}else{workerResult.results=[];postMessage(workerResult)}}catch(error){workerResult.error=error;postMessage(workerResult);console.log("worker - error: %s",error)}}if(!/\*/g.test(apiRefSearchTerm)&&!hasResults){try{apiRefLunrSearchResults=apiRefSearchIndex.query(function(q){q.term(apiRefSearchTerm,{wildcard:lunr.Query.wildcard.TRAILING});q.term(apiRefSearchTerm,{wildcard:lunr.Query.wildcard.LEADING});q.term(apiRefSearchTerm,{wildcard:lunr.Query.wildcard.LEADING|lunr.Query.wildcard.TRAILING});q.term(apiRefSearchTerm,{usePipeline:true,boost:50});q.term(apiRefSearchTerm,{usePipeline:false,boost:10,wildcard:lunr.Query.wildcard.TRAILING});q.term(apiRefSearchTerm,{usePipeline:false,editDistance:2,boost:1})});hasResults=hasSearchResults(apiRefLunrSearchResults);if(hasResults){processAPIReferenceSearchResults(apiRefLunrSearchResults,apiRefSearchData).then(function(resolve){workerResult.results=resolve.records;postMessage(workerResult)})}else{workerResult.results=[];postMessage(workerResult)}}catch(error){workerResult.error=error;postMessage(workerResult);console.log("worker - error: %s",error)}}}}else if(workerData.type==="sample-code-search"){var sampleCodeLunrSearchResults=undefined;var sampleSearchTerm=workerData.value;var matchTags={title:[],tags:[]};workerResult.value=sampleSearchTerm;if(/(\s|\*$)/.test(sampleSearchTerm)){sampleCodeLunrSearchResults=sampleCodeSearchIndex.search(sampleSearchTerm)}else if(/\d\.\d/.test(sampleSearchTerm)){sampleCodeLunrSearchResults=sampleCodeSearchIndex.search(sampleSearchTerm)}else{try{sampleCodeLunrSearchResults=sampleCodeSearchIndex.search(sampleSearchTerm);if(sampleCodeLunrSearchResults.length<1){sampleCodeLunrSearchResults=sampleCodeSearchIndex.query(function(q){q.term(sampleSearchTerm,{wildcard:lunr.Query.wildcard.TRAILING});q.term(sampleSearchTerm,{wildcard:lunr.Query.wildcard.LEADING});q.term(sampleSearchTerm,{wildcard:lunr.Query.wildcard.LEADING|lunr.Query.wildcard.TRAILING});q.term(sampleSearchTerm,{usePipeline:true,boost:50});q.term(sampleSearchTerm,{usePipeline:false,boost:10,wildcard:lunr.Query.wildcard.TRAILING});q.term(sampleSearchTerm,{usePipeline:false,editDistance:2,boost:1})})}}catch(error){workerResult.error=error;postMessage(workerResult);console.log("Error: %s",error)}}var sampleCodeResults=[];Object.keys(sampleCodeLunrSearchResults).forEach(function(sampleResult){var searchResultMetadata=sampleCodeLunrSearchResults[sampleResult].matchData.metadata;var result=sampleCodeSearchData[sampleCodeLunrSearchResults[sampleResult].ref];var pageMeta=sampleCodeSearchData[sampleCodeLunrSearchResults[sampleResult].ref];var isExternalSample=pageMeta.is_external_sample!==undefined&&!pageMeta.is_external_sample?false:true;var sandboxEnabled=pageMeta.sandbox!==undefined&&!pageMeta.sandbox?false:true;var jsShareEnabled=pageMeta.jsshare!==undefined&&!pageMeta.jsshare?false:true;Object.keys(searchResultMetadata).forEach(function(term){Object.keys(searchResultMetadata[term]).forEach(function(fieldName){if(searchResultMetadata[term][fieldName]){var positions=searchResultMetadata[term][fieldName].position;if(result[fieldName]){matchTags[fieldName].push(result[fieldName].substr(positions[0][0],positions[0][1]))}}})});sampleCodeResults.push({result:result,pageMeta:pageMeta,isExternalSample:isExternalSample,sandboxEnabled:sandboxEnabled,jsShareEnabled:jsShareEnabled})});workerResult.results=sampleCodeResults;workerResult.matchTags=matchTags;postMessage(workerResult)}else{console.log("Posting message back to main script");postMessage(workerResult)}},searchMilliSecondsDelay);self.postMessage(readyMessage)}else{console.log("worker - importScripts is undefined")}